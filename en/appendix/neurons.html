
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Neuron models Â· BrainPy Handbook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="synapses.html" />
    
    
    <link rel="prev" href="../appendix.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    0. Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../neurons.html">
            
                <a href="../neurons.html">
            
                    
                    1. Neuron models
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../neurons/biological_background.html">
            
                <a href="../neurons/biological_background.html">
            
                    
                    1.1 Biological background
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../neurons/biophysical_models.html">
            
                <a href="../neurons/biophysical_models.html">
            
                    
                    1.2 Biophysical models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../neurons/reduced_models.html">
            
                <a href="../neurons/reduced_models.html">
            
                    
                    1.3 Reduced models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../neurons/firing_rate_models.html">
            
                <a href="../neurons/firing_rate_models.html">
            
                    
                    1.4 Firing rate models
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../synapses.html">
            
                <a href="../synapses.html">
            
                    
                    2. Synapse models
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../synapses/dynamics.html">
            
                <a href="../synapses/dynamics.html">
            
                    
                    2.1 Synaptic models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../synapses/plasticity.html">
            
                <a href="../synapses/plasticity.html">
            
                    
                    2.2 Plasticity models
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../networks.html">
            
                <a href="../networks.html">
            
                    
                    3. Network models
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../networks/EI_balanced_network.html">
            
                <a href="../networks/EI_balanced_network.html">
            
                    
                    3.1 E-I balanced network
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../networks/decision_making_networks.html">
            
                <a href="../networks/decision_making_networks.html">
            
                    
                    3.2 Decision making networks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../networks/cann.html">
            
                <a href="../networks/cann.html">
            
                    
                    3.3 Continuous attractor neural network
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../appendix.html">
            
                <a href="../appendix.html">
            
                    
                    Appendix: model code
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.5.1" data-path="neurons.html">
            
                <a href="neurons.html">
            
                    
                    Neuron models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="synapses.html">
            
                <a href="synapses.html">
            
                    
                    Synapse models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="networks.html">
            
                <a href="networks.html">
            
                    
                    Network models
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Neuron models</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="biophysical-models">Biophysical models</h2>
<h3 id="hodgkin-huxley-model">Hodgkin-Huxley model</h3>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> brainpy <span class="hljs-keyword">as</span> bp
<span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> prange

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HH</span><span class="hljs-params">(bp.NeuGroup)</span>:</span>
  target_backend = <span class="hljs-string">&apos;general&apos;</span>

<span class="hljs-meta">  @staticmethod</span>
<span class="hljs-meta">  @bp.odeint(method=&apos;exponential_euler&apos;)</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">integral</span><span class="hljs-params">(V, m, h, n, t, C, gNa, ENa, gK, EK, gL, EL, Iext)</span>:</span>
    alpha_m = <span class="hljs-number">0.1</span>*(V+<span class="hljs-number">40</span>)/(<span class="hljs-number">1</span>-bp.ops.exp(-(V+<span class="hljs-number">40</span>)/<span class="hljs-number">10</span>))
    beta_m = <span class="hljs-number">4.0</span>*bp.ops.exp(-(V+<span class="hljs-number">65</span>)/<span class="hljs-number">18</span>)
    dmdt = alpha_m * (<span class="hljs-number">1</span> - m) - beta_m * m

    alpha_h = <span class="hljs-number">0.07</span>*bp.ops.exp(-(V+<span class="hljs-number">65</span>)/<span class="hljs-number">20</span>)
    beta_h = <span class="hljs-number">1</span>/(<span class="hljs-number">1</span>+bp.ops.exp(-(V+<span class="hljs-number">35</span>)/<span class="hljs-number">10</span>))
    dhdt = alpha_h * (<span class="hljs-number">1</span> - h) - beta_h * h

    alpha_n = <span class="hljs-number">0.01</span>*(V+<span class="hljs-number">55</span>)/(<span class="hljs-number">1</span>-bp.ops.exp(-(V+<span class="hljs-number">55</span>)/<span class="hljs-number">10</span>))
    beta_n = <span class="hljs-number">0.125</span>*bp.ops.exp(-(V+<span class="hljs-number">65</span>)/<span class="hljs-number">80</span>)
    dndt = alpha_n * (<span class="hljs-number">1</span> - n) - beta_n * n

    I_Na = (gNa * m ** <span class="hljs-number">3.0</span> * h) * (V - ENa)
    I_K = (gK * n ** <span class="hljs-number">4.0</span>) * (V - EK)
    I_leak = gL * (V - EL)
    dVdt = (- I_Na - I_K - I_leak + Iext) / C

    <span class="hljs-keyword">return</span> dVdt, dmdt, dhdt, dndt

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, size, ENa=<span class="hljs-number">50.</span>, gNa=<span class="hljs-number">120.</span>, EK=<span class="hljs-number">-77.</span>, gK=<span class="hljs-number">36.</span>,
               EL=<span class="hljs-number">-54.387</span>, gL=<span class="hljs-number">0.03</span>, V_th=<span class="hljs-number">20.</span>, C=<span class="hljs-number">1.0</span>, **kwargs)</span>:</span>
    <span class="hljs-comment"># parameters</span>
    self.ENa = ENa
    self.EK = EK
    self.EL = EL
    self.gNa = gNa
    self.gK = gK
    self.gL = gL
    self.C = C
    self.V_th = V_th

    <span class="hljs-comment"># variables</span>
    num = bp.size2len(size)
    self.V = <span class="hljs-number">-65.</span> * bp.ops.ones(num)
    self.m = <span class="hljs-number">0.5</span> * bp.ops.ones(num)
    self.h = <span class="hljs-number">0.6</span> * bp.ops.ones(num)
    self.n = <span class="hljs-number">0.32</span> * bp.ops.ones(num)
    self.spike = bp.ops.zeros(num, dtype=bool)
    self.input = bp.ops.zeros(num)

    super(HH, self).__init__(size=size, **kwargs)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(self, _t)</span>:</span>
    V, m, h, n = self.integral(self.V, self.m, self.h, self.n, _t,
                               self.C, self.gNa, self.ENa, self.gK,
                               self.EK, self.gL, self.EL, self.input)
    self.spike = (self.V &lt; self.V_th) * (V &gt;= self.V_th)
    self.V = V
    self.m = m
    self.h = h
    self.n = n
    self.input[:] = <span class="hljs-number">0</span>

<span class="hljs-keyword">import</span> brainpy <span class="hljs-keyword">as</span> bp

dt = <span class="hljs-number">0.1</span>
bp.backend.set(<span class="hljs-string">&apos;numpy&apos;</span>, dt=dt)
neu = HH(<span class="hljs-number">100</span>, monitors=[<span class="hljs-string">&apos;V&apos;</span>, <span class="hljs-string">&apos;spike&apos;</span>])
neu.t_refractory = <span class="hljs-number">5.</span>
net = bp.Network(neu)
net.run(duration=<span class="hljs-number">200.</span>, inputs=(neu, <span class="hljs-string">&apos;input&apos;</span>, <span class="hljs-number">21.</span>), report=<span class="hljs-keyword">True</span>)
fig, gs = bp.visualize.get_figure(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">10</span>)
fig.add_subplot(gs[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>])
bp.visualize.line_plot(neu.mon.ts, neu.mon.V,
                       xlabel=<span class="hljs-string">&quot;t&quot;</span>, ylabel=<span class="hljs-string">&quot;V&quot;</span>, show=<span class="hljs-keyword">True</span>)
</code></pre>
<hr>
<h2 id="reduced-models">Reduced models</h2>
<h3 id="lif-model">LIF model</h3>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> brainpy <span class="hljs-keyword">as</span> bp
<span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> prange

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LIF</span><span class="hljs-params">(bp.NeuGroup)</span>:</span>
  target_backend = [<span class="hljs-string">&apos;numpy&apos;</span>, <span class="hljs-string">&apos;numba&apos;</span>, <span class="hljs-string">&apos;numba-parallel&apos;</span>, <span class="hljs-string">&apos;numba-cuda&apos;</span>]

<span class="hljs-meta">  @staticmethod</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">derivative</span><span class="hljs-params">(V, t, Iext, V_rest, R, tau)</span>:</span>
    dvdt = (-V + V_rest + R * Iext) / tau
    <span class="hljs-keyword">return</span> dvdt

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, size, t_refractory=<span class="hljs-number">1.</span>, V_rest=<span class="hljs-number">0.</span>,
               V_reset=<span class="hljs-number">-5.</span>, V_th=<span class="hljs-number">20.</span>, R=<span class="hljs-number">1.</span>, tau=<span class="hljs-number">10.</span>, **kwargs)</span>:</span>
    <span class="hljs-comment"># parameters</span>
    self.V_rest = V_rest
    self.V_reset = V_reset
    self.V_th = V_th
    self.R = R
    self.tau = tau
    self.t_refractory = t_refractory

    <span class="hljs-comment"># variables</span>
    num = bp.size2len(size)
    self.t_last_spike = bp.ops.ones(num) * <span class="hljs-number">-1e7</span>
    self.input = bp.ops.zeros(num)
    self.refractory = bp.ops.zeros(num, dtype=bool)
    self.spike = bp.ops.zeros(num, dtype=bool)
    self.V = bp.ops.ones(num) * V_rest

    self.integral = bp.odeint(self.derivative)
    super(LIF, self).__init__(size=size, **kwargs)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(self, _t)</span>:</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> prange(self.size[<span class="hljs-number">0</span>]):
      spike = <span class="hljs-number">0.</span>
      refractory = (_t - self.t_last_spike[i] &lt;= self.t_refractory)
      <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> refractory:
        V = self.integral(self.V[i], _t, self.input[i],
                          self.V_rest, self.R, self.tau)
        spike = (V &gt;= self.V_th)
        <span class="hljs-keyword">if</span> spike:
          V = self.V_reset
          self.t_last_spike[i] = _t
        self.V[i] = V
      self.spike[i] = spike
      self.refractory[i] = refractory <span class="hljs-keyword">or</span> spike
      self.input[i] = <span class="hljs-number">0.</span>

<span class="hljs-keyword">import</span> brainpy <span class="hljs-keyword">as</span> bp

dt = <span class="hljs-number">0.1</span>
bp.backend.set(<span class="hljs-string">&apos;numpy&apos;</span>, dt=dt)
neu = LIF(<span class="hljs-number">100</span>, monitors=[<span class="hljs-string">&apos;V&apos;</span>, <span class="hljs-string">&apos;refractory&apos;</span>, <span class="hljs-string">&apos;spike&apos;</span>])
neu.t_refractory = <span class="hljs-number">5.</span>
net = bp.Network(neu)
net.run(duration=<span class="hljs-number">200.</span>, inputs=(neu, <span class="hljs-string">&apos;input&apos;</span>, <span class="hljs-number">21.</span>), report=<span class="hljs-keyword">True</span>)
fig, gs = bp.visualize.get_figure(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">10</span>)
fig.add_subplot(gs[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>])
bp.visualize.line_plot(neu.mon.ts, neu.mon.V,
                       xlabel=<span class="hljs-string">&quot;t&quot;</span>, ylabel=<span class="hljs-string">&quot;V&quot;</span>, show=<span class="hljs-keyword">True</span>)
</code></pre>
<hr>
<h3 id="quaif-model">QuaIF model</h3>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> brainpy <span class="hljs-keyword">as</span> bp
<span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> prange

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuaIF</span><span class="hljs-params">(bp.NeuGroup)</span>:</span>
  target_backend = <span class="hljs-string">&apos;general&apos;</span>

<span class="hljs-meta">  @staticmethod</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">derivative</span><span class="hljs-params">(V, t, I_ext, V_rest, V_c, R, tau, a_0)</span>:</span>
    dVdt = (a_0 * (V - V_rest) * (V - V_c) + R * I_ext) / tau
    <span class="hljs-keyword">return</span> dVdt

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, size, V_rest=<span class="hljs-number">-65.</span>, V_reset=<span class="hljs-number">-68.</span>,
               V_th=<span class="hljs-number">-30.</span>, V_c=<span class="hljs-number">-50.0</span>, a_0=<span class="hljs-number">.07</span>,
               R=<span class="hljs-number">1.</span>, tau=<span class="hljs-number">10.</span>, t_refractory=<span class="hljs-number">0.</span>, **kwargs)</span>:</span>
    <span class="hljs-comment"># parameters</span>
    self.V_rest = V_rest
    self.V_reset = V_reset
    self.V_th = V_th
    self.V_c = V_c
    self.a_0 = a_0
    self.R = R
    self.tau = tau
    self.t_refractory = t_refractory

    <span class="hljs-comment"># variables</span>
    num = bp.size2len(size)
    self.V = bp.ops.ones(num) * V_reset
    self.input = bp.ops.zeros(num)
    self.spike = bp.ops.zeros(num, dtype=bool)
    self.refractory = bp.ops.zeros(num, dtype=bool)
    self.t_last_spike = bp.ops.ones(num) * <span class="hljs-number">-1e7</span>

    self.integral = bp.odeint(f=self.derivative, method=<span class="hljs-string">&apos;euler&apos;</span>)
    super(QuaIF, self).__init__(size=size, **kwargs)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(self, _t)</span>:</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> prange(self.size[<span class="hljs-number">0</span>]):
      spike = <span class="hljs-number">0.</span>
      refractory = (_t - self.t_last_spike[i] &lt;= self.t_refractory)
      <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> refractory:
        V = self.integral(self.V[i], _t, self.input[i],
                          self.V_rest, self.V_c, self.R,
                          self.tau, self.a_0)
        spike = (V &gt;= self.V_th)
        <span class="hljs-keyword">if</span> spike:
          V = self.V_rest
          self.t_last_spike[i] = _t
        self.V[i] = V
      self.spike[i] = spike
      self.refractory[i] = refractory <span class="hljs-keyword">or</span> spike
      self.input[i] = <span class="hljs-number">0.</span>


dt = <span class="hljs-number">0.1</span>
bp.backend.set(<span class="hljs-string">&apos;numpy&apos;</span>, dt=dt)
neu = QuaIF(<span class="hljs-number">100</span>, monitors=[<span class="hljs-string">&apos;V&apos;</span>, <span class="hljs-string">&apos;refractory&apos;</span>, <span class="hljs-string">&apos;spike&apos;</span>])
neu.t_refractory = <span class="hljs-number">5.</span>
net = bp.Network(neu)
net.run(duration=<span class="hljs-number">200.</span>, inputs=(neu, <span class="hljs-string">&apos;input&apos;</span>, <span class="hljs-number">21.</span>), report=<span class="hljs-keyword">True</span>)
fig, gs = bp.visualize.get_figure(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">10</span>)
fig.add_subplot(gs[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>])
bp.visualize.line_plot(neu.mon.ts, neu.mon.V,
                       xlabel=<span class="hljs-string">&quot;t&quot;</span>, ylabel=<span class="hljs-string">&quot;V&quot;</span>, show=<span class="hljs-keyword">True</span>)
</code></pre>
<hr>
<h3 id="expif-model">ExpIF model</h3>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> brainpy <span class="hljs-keyword">as</span> bp
<span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> prange

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExpIF</span><span class="hljs-params">(bp.NeuGroup)</span>:</span>
  target_backend = <span class="hljs-string">&apos;general&apos;</span>

<span class="hljs-meta">  @staticmethod</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">derivative</span><span class="hljs-params">(V, t, I_ext, V_rest, delta_T, V_T, R, tau)</span>:</span>
    exp_term = bp.ops.exp((V - V_T) / delta_T)
    dvdt = (-(V-V_rest) + delta_T*exp_term + R*I_ext) / tau
    <span class="hljs-keyword">return</span> dvdt

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, size, V_rest=<span class="hljs-number">-65.</span>, V_reset=<span class="hljs-number">-68.</span>,
               V_th=<span class="hljs-number">-30.</span>, V_T=<span class="hljs-number">-59.9</span>, delta_T=<span class="hljs-number">3.48</span>,
               R=<span class="hljs-number">10.</span>, C=<span class="hljs-number">1.</span>, tau=<span class="hljs-number">10.</span>, t_refractory=<span class="hljs-number">1.7</span>,
               **kwargs)</span>:</span>
    <span class="hljs-comment"># parameters</span>
    self.V_rest = V_rest
    self.V_reset = V_reset
    self.V_th = V_th
    self.V_T = V_T
    self.delta_T = delta_T
    self.R = R
    self.C = C
    self.tau = tau
    self.t_refractory = t_refractory

    <span class="hljs-comment"># variables</span>
    self.V = bp.ops.ones(size) * V_rest
    self.input = bp.ops.zeros(size)
    self.spike = bp.ops.zeros(size, dtype=bool)
    self.refractory = bp.ops.zeros(size, dtype=bool)
    self.t_last_spike = bp.ops.ones(size) * <span class="hljs-number">-1e7</span>

    self.integral = bp.odeint(self.derivative)
    super(ExpIF, self).__init__(size=size, **kwargs)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(self, _t)</span>:</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> prange(self.num):
      spike = <span class="hljs-number">0.</span>
      refractory = (_t - self.t_last_spike[i] &lt;= self.t_refractory)
      <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> refractory:
        V = self.integral(
          self.V[i], _t, self.input[i], self.V_rest,
          self.delta_T, self.V_T, self.R, self.tau
        )
        spike = (V &gt;= self.V_th)
        <span class="hljs-keyword">if</span> spike:
          V = self.V_reset
          self.t_last_spike[i] = _t
        self.V[i] = V
      self.spike[i] = spike
      self.refractory[i] = refractory <span class="hljs-keyword">or</span> spike
    self.input[:] = <span class="hljs-number">0.</span>

dt = <span class="hljs-number">0.1</span>
bp.backend.set(<span class="hljs-string">&apos;numpy&apos;</span>, dt=dt)
neu = ExpIF(<span class="hljs-number">100</span>, monitors=[<span class="hljs-string">&apos;V&apos;</span>, <span class="hljs-string">&apos;refractory&apos;</span>, <span class="hljs-string">&apos;spike&apos;</span>])
neu.t_refractory = <span class="hljs-number">5.</span>
net = bp.Network(neu)
net.run(duration=<span class="hljs-number">200.</span>, inputs=(neu, <span class="hljs-string">&apos;input&apos;</span>, <span class="hljs-number">21.</span>), report=<span class="hljs-keyword">True</span>)
fig, gs = bp.visualize.get_figure(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">10</span>)
fig.add_subplot(gs[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>])
bp.visualize.line_plot(neu.mon.ts, neu.mon.V,
                       xlabel=<span class="hljs-string">&quot;t&quot;</span>, ylabel=<span class="hljs-string">&quot;V&quot;</span>, show=<span class="hljs-keyword">True</span>)
</code></pre>
<hr>
<h3 id="adexif-model">AdExIF model</h3>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> brainpy <span class="hljs-keyword">as</span> bp
<span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> prange

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdExIF</span><span class="hljs-params">(bp.NeuGroup)</span>:</span>
  target_backend = <span class="hljs-string">&apos;general&apos;</span>

<span class="hljs-meta">  @staticmethod</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">derivative</span><span class="hljs-params">(V, w, t, I_ext, V_rest, delta_T, V_T, R, tau, tau_w, a)</span>:</span>
    exp_term = bp.ops.exp((V-V_T)/delta_T)
    dVdt = (-(V-V_rest)+delta_T*exp_term-R*w+R*I_ext)/tau

    dwdt = (a*(V-V_rest)-w)/tau_w

    <span class="hljs-keyword">return</span> dVdt, dwdt

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, size, V_rest=<span class="hljs-number">-65.</span>, V_reset=<span class="hljs-number">-68.</span>,
               V_th=<span class="hljs-number">-30.</span>, V_T=<span class="hljs-number">-59.9</span>, delta_T=<span class="hljs-number">3.48</span>,
               a=<span class="hljs-number">1.</span>, b=<span class="hljs-number">1.</span>, R=<span class="hljs-number">10.</span>, tau=<span class="hljs-number">10.</span>, tau_w=<span class="hljs-number">30.</span>,
               t_refractory=<span class="hljs-number">0.</span>, **kwargs)</span>:</span>
    <span class="hljs-comment"># parameters</span>
    self.V_rest = V_rest
    self.V_reset = V_reset
    self.V_th = V_th
    self.V_T = V_T
    self.delta_T = delta_T
    self.a = a
    self.b = b
    self.R = R
    self.tau = tau
    self.tau_w = tau_w
    self.t_refractory = t_refractory

    <span class="hljs-comment"># variables</span>
    num = bp.size2len(size)
    self.V = bp.ops.ones(num) * V_reset
    self.w = bp.ops.zeros(size)
    self.input = bp.ops.zeros(num)
    self.spike = bp.ops.zeros(num, dtype=bool)
    self.refractory = bp.ops.zeros(num, dtype=bool)
    self.t_last_spike = bp.ops.ones(num) * <span class="hljs-number">-1e7</span>

    self.integral = bp.odeint(f=self.derivative, method=<span class="hljs-string">&apos;euler&apos;</span>)

    super(AdExIF, self).__init__(size=size, **kwargs)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(self, _t)</span>:</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> prange(self.size[<span class="hljs-number">0</span>]):
      spike = <span class="hljs-number">0.</span>
      refractory = (_t - self.t_last_spike[i] &lt;= self.t_refractory)
      <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> refractory:
        V, w = self.integral(self.V[i], self.w[i], _t, self.input[i],
                             self.V_rest, self.delta_T,
                             self.V_T, self.R, self.tau, self.tau_w, self.a)
        spike = (V &gt;= self.V_th)
        <span class="hljs-keyword">if</span> spike:
          V = self.V_rest
          w += self.b
          self.t_last_spike[i] = _t
        self.V[i] = V
        self.w[i] = w
      self.spike[i] = spike
      self.refractory[i] = refractory <span class="hljs-keyword">or</span> spike
      self.input[i] = <span class="hljs-number">0.</span>

dt = <span class="hljs-number">0.1</span>
bp.backend.set(<span class="hljs-string">&apos;numpy&apos;</span>, dt=dt)
neu = AdExIF(<span class="hljs-number">100</span>, monitors=[<span class="hljs-string">&apos;V&apos;</span>, <span class="hljs-string">&apos;refractory&apos;</span>, <span class="hljs-string">&apos;spike&apos;</span>])
neu.t_refractory = <span class="hljs-number">5.</span>
net = bp.Network(neu)
net.run(duration=<span class="hljs-number">200.</span>, inputs=(neu, <span class="hljs-string">&apos;input&apos;</span>, <span class="hljs-number">21.</span>), report=<span class="hljs-keyword">True</span>)
fig, gs = bp.visualize.get_figure(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">10</span>)
fig.add_subplot(gs[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>])
bp.visualize.line_plot(neu.mon.ts, neu.mon.V,
                       xlabel=<span class="hljs-string">&quot;t&quot;</span>, ylabel=<span class="hljs-string">&quot;V&quot;</span>, show=<span class="hljs-keyword">True</span>)
</code></pre>
<hr>
<h3 id="hindmarsh-rose-model">Hindmarsh-Rose model</h3>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> brainpy <span class="hljs-keyword">as</span> bp
<span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> prange


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HindmarshRose</span><span class="hljs-params">(bp.NeuGroup)</span>:</span>
    target_backend = <span class="hljs-string">&apos;general&apos;</span>

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">derivative</span><span class="hljs-params">(V, y, z, t, a, b, I_ext, c, d, r, s, V_rest)</span>:</span>
        dVdt = y - a * V * V * V + b * V * V - z + I_ext
        dydt = c - d * V * V - y
        dzdt = r * (s * (V - V_rest) - z)
        <span class="hljs-keyword">return</span> dVdt, dydt, dzdt

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, size, a=<span class="hljs-number">1.</span>, b=<span class="hljs-number">3.</span>,
                 c=<span class="hljs-number">1.</span>, d=<span class="hljs-number">5.</span>, r=<span class="hljs-number">0.01</span>, s=<span class="hljs-number">4.</span>,
                 V_rest=<span class="hljs-number">-1.6</span>, **kwargs)</span>:</span>
        <span class="hljs-comment"># parameters</span>
        self.a = a
        self.b = b
        self.c = c
        self.d = d
        self.r = r
        self.s = s
        self.V_rest = V_rest

        <span class="hljs-comment"># variables</span>
        num = bp.size2len(size)
        self.z = bp.ops.zeros(num)
        self.input = bp.ops.zeros(num)
        self.V = bp.ops.ones(num) * <span class="hljs-number">-1.6</span>
        self.y = bp.ops.ones(num) * <span class="hljs-number">-10.</span>
        self.spike = bp.ops.zeros(num, dtype=bool)

        self.integral = bp.odeint(f=self.derivative)
        super(HindmarshRose, self).__init__(size=size, **kwargs)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(self, _t)</span>:</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> prange(self.num):
            V, self.y[i], self.z[i] = self.integral(
                self.V[i], self.y[i], self.z[i], _t,
                self.a, self.b, self.input[i],
                self.c, self.d, self.r, self.s,
                self.V_rest)
            self.V[i] = V
            self.input[i] = <span class="hljs-number">0.</span>


bp.backend.set(<span class="hljs-string">&apos;numba&apos;</span>, dt=<span class="hljs-number">0.02</span>)
mode = <span class="hljs-string">&apos;irregular_bursting&apos;</span>
param = {<span class="hljs-string">&apos;quiescence&apos;</span>: [<span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>],  <span class="hljs-comment"># a</span>
         <span class="hljs-string">&apos;spiking&apos;</span>: [<span class="hljs-number">3.5</span>, <span class="hljs-number">5.0</span>],  <span class="hljs-comment"># c</span>
         <span class="hljs-string">&apos;bursting&apos;</span>: [<span class="hljs-number">2.5</span>, <span class="hljs-number">3.0</span>],  <span class="hljs-comment"># d</span>
         <span class="hljs-string">&apos;irregular_spiking&apos;</span>: [<span class="hljs-number">2.95</span>, <span class="hljs-number">3.3</span>],  <span class="hljs-comment"># h</span>
         <span class="hljs-string">&apos;irregular_bursting&apos;</span>: [<span class="hljs-number">2.8</span>, <span class="hljs-number">3.7</span>],  <span class="hljs-comment"># g</span>
         }
<span class="hljs-comment"># set params of b and I_ext corresponding to different firing mode</span>
print(f<span class="hljs-string">&quot;parameters is set to firing mode &lt;{mode}&gt;&quot;</span>)

group = HindmarshRose(size=<span class="hljs-number">10</span>, b=param[mode][<span class="hljs-number">0</span>],
                      monitors=[<span class="hljs-string">&apos;V&apos;</span>, <span class="hljs-string">&apos;y&apos;</span>, <span class="hljs-string">&apos;z&apos;</span>])

group.run(<span class="hljs-number">350.</span>, inputs=(<span class="hljs-string">&apos;input&apos;</span>, param[mode][<span class="hljs-number">1</span>]), report=<span class="hljs-keyword">True</span>)
bp.visualize.line_plot(group.mon.ts, group.mon.V, show=<span class="hljs-keyword">True</span>)



<span class="hljs-comment"># Phase plane analysis</span>
phase_plane_analyzer = bp.analysis.PhasePlane(
    group.integral,
    target_vars={<span class="hljs-string">&apos;V&apos;</span>: [<span class="hljs-number">-3.</span>, <span class="hljs-number">3.</span>], <span class="hljs-string">&apos;y&apos;</span>: [<span class="hljs-number">-20.</span>, <span class="hljs-number">5.</span>]},
    fixed_vars={<span class="hljs-string">&apos;z&apos;</span>: <span class="hljs-number">0.</span>},
    pars_update={<span class="hljs-string">&apos;I_ext&apos;</span>: param[mode][<span class="hljs-number">1</span>], <span class="hljs-string">&apos;a&apos;</span>: <span class="hljs-number">1.</span>, <span class="hljs-string">&apos;b&apos;</span>: <span class="hljs-number">3.</span>,
                 <span class="hljs-string">&apos;c&apos;</span>: <span class="hljs-number">1.</span>, <span class="hljs-string">&apos;d&apos;</span>: <span class="hljs-number">5.</span>, <span class="hljs-string">&apos;r&apos;</span>: <span class="hljs-number">0.01</span>, <span class="hljs-string">&apos;s&apos;</span>: <span class="hljs-number">4.</span>,
                 <span class="hljs-string">&apos;V_rest&apos;</span>: <span class="hljs-number">-1.6</span>}
)
phase_plane_analyzer.plot_nullcline()
phase_plane_analyzer.plot_fixed_point()
phase_plane_analyzer.plot_vector_field()
phase_plane_analyzer.plot_trajectory(
    [{<span class="hljs-string">&apos;V&apos;</span>: <span class="hljs-number">1.</span>, <span class="hljs-string">&apos;y&apos;</span>: <span class="hljs-number">0.</span>, <span class="hljs-string">&apos;z&apos;</span>: <span class="hljs-number">-0.</span>}],
    duration=<span class="hljs-number">100.</span>,
    show=<span class="hljs-keyword">True</span>
)
</code></pre>
<hr>
<h3 id="generalizedif-model">GeneralizedIF model</h3>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> brainpy <span class="hljs-keyword">as</span> bp
<span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> prange

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GeneralizedIF</span><span class="hljs-params">(bp.NeuGroup)</span>:</span>
  target_backend = <span class="hljs-string">&apos;general&apos;</span>

<span class="hljs-meta">  @staticmethod</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">derivative</span><span class="hljs-params">(I1, I2, V_th, V, t,
                 k1, k2, a, V_rest, b, V_th_inf,
                 R, I_ext, tau)</span>:</span>
    dI1dt = - k1 * I1
    dI2dt = - k2 * I2
    dVthdt = a * (V - V_rest) - b * (V_th - V_th_inf)
    dVdt = (- (V - V_rest) + R * I_ext + R * I1 + R * I2) / tau
    <span class="hljs-keyword">return</span> dI1dt, dI2dt, dVthdt, dVdt

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, size, V_rest=<span class="hljs-number">-70.</span>, V_reset=<span class="hljs-number">-70.</span>,
               V_th_inf=<span class="hljs-number">-50.</span>, V_th_reset=<span class="hljs-number">-60.</span>, R=<span class="hljs-number">20.</span>, tau=<span class="hljs-number">20.</span>,
               a=<span class="hljs-number">0.</span>, b=<span class="hljs-number">0.01</span>, k1=<span class="hljs-number">0.2</span>, k2=<span class="hljs-number">0.02</span>,
               R1=<span class="hljs-number">0.</span>, R2=<span class="hljs-number">1.</span>, A1=<span class="hljs-number">0.</span>, A2=<span class="hljs-number">0.</span>,
               **kwargs)</span>:</span>
    <span class="hljs-comment"># params</span>
    self.V_rest = V_rest
    self.V_reset = V_reset
    self.V_th_inf = V_th_inf
    self.V_th_reset = V_th_reset
    self.R = R
    self.tau = tau
    self.a = a
    self.b = b
    self.k1 = k1
    self.k2 = k2
    self.R1 = R1
    self.R2 = R2
    self.A1 = A1
    self.A2 = A2

    <span class="hljs-comment"># vars</span>
    self.input = bp.ops.zeros(size)
    self.spike = bp.ops.zeros(size, dtype=bool)
    self.I1 = bp.ops.zeros(size)
    self.I2 = bp.ops.zeros(size)
    self.V = bp.ops.ones(size) * <span class="hljs-number">-70.</span>
    self.V_th = bp.ops.ones(size) * <span class="hljs-number">-50.</span>

    self.integral = bp.odeint(self.derivative)
    super(GeneralizedIF, self).__init__(size=size, **kwargs)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(self, _t)</span>:</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> prange(self.size[<span class="hljs-number">0</span>]):
      I1, I2, V_th, V = self.integral(
        self.I1[i], self.I2[i], self.V_th[i], self.V[i], _t,
        self.k1, self.k2, self.a, self.V_rest,
        self.b, self.V_th_inf,
        self.R, self.input[i], self.tau
      )
      self.spike[i] = self.V_th[i] &lt; V
      <span class="hljs-keyword">if</span> self.spike[i]:
        V = self.V_reset
        I1 = self.R1 * I1 + self.A1
        I2 = self.R2 * I2 + self.A2
        V_th = max(V_th, self.V_th_reset)
      self.I1[i] = I1
      self.I2[i] = I2
      self.V_th[i] = V_th
      self.V[i] = V
    self.f = <span class="hljs-number">0.</span>
    self.input[:] = self.f

<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> brainpy <span class="hljs-keyword">as</span> bp
<span class="hljs-keyword">import</span> brainmodels

<span class="hljs-comment"># set parameters</span>
num2mode = [<span class="hljs-string">&quot;tonic_spiking&quot;</span>, <span class="hljs-string">&quot;class_1&quot;</span>, <span class="hljs-string">&quot;spike_frequency_adaptation&quot;</span>,
            <span class="hljs-string">&quot;phasic_spiking&quot;</span>, <span class="hljs-string">&quot;accomodation&quot;</span>, <span class="hljs-string">&quot;threshold_variability&quot;</span>,
            <span class="hljs-string">&quot;rebound_spike&quot;</span>, <span class="hljs-string">&quot;class_2&quot;</span>, <span class="hljs-string">&quot;integrator&quot;</span>,
            <span class="hljs-string">&quot;input_bistability&quot;</span>, <span class="hljs-string">&quot;hyperpolarization_induced_spiking&quot;</span>, <span class="hljs-string">&quot;hyperpolarization_induced_bursting&quot;</span>,
            <span class="hljs-string">&quot;tonic_bursting&quot;</span>, <span class="hljs-string">&quot;phasic_bursting&quot;</span>, <span class="hljs-string">&quot;rebound_burst&quot;</span>,
            <span class="hljs-string">&quot;mixed_mode&quot;</span>, <span class="hljs-string">&quot;afterpotentials&quot;</span>, <span class="hljs-string">&quot;basal_bistability&quot;</span>,
            <span class="hljs-string">&quot;preferred_frequency&quot;</span>, <span class="hljs-string">&quot;spike_latency&quot;</span>]

mode2param = {
    <span class="hljs-string">&quot;tonic_spiking&quot;</span>: {
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">1.5</span>, <span class="hljs-number">200.</span>)]
    },
    <span class="hljs-string">&quot;class_1&quot;</span>: {
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">1.</span> + <span class="hljs-number">1e-6</span>, <span class="hljs-number">500.</span>)]
    },
    <span class="hljs-string">&quot;spike_frequency_adaptation&quot;</span>: {
        <span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0.005</span>, <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">2.</span>, <span class="hljs-number">200.</span>)]
    },
    <span class="hljs-string">&quot;phasic_spiking&quot;</span>: {
        <span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0.005</span>, <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">1.5</span>, <span class="hljs-number">500.</span>)]
    },
    <span class="hljs-string">&quot;accomodation&quot;</span>: {
        <span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0.005</span>,
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">1.5</span>, <span class="hljs-number">100.</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">500.</span>), (<span class="hljs-number">0.5</span>, <span class="hljs-number">100.</span>),
                  (<span class="hljs-number">1.</span>, <span class="hljs-number">100.</span>), (<span class="hljs-number">1.5</span>, <span class="hljs-number">100.</span>), (<span class="hljs-number">0.</span>, <span class="hljs-number">100.</span>)]
    },
    <span class="hljs-string">&quot;threshold_variability&quot;</span>: {
        <span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0.005</span>,
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">1.5</span>, <span class="hljs-number">20.</span>), (<span class="hljs-number">0.</span>, <span class="hljs-number">180.</span>), (<span class="hljs-number">-1.5</span>, <span class="hljs-number">20.</span>),
                  (<span class="hljs-number">0.</span>, <span class="hljs-number">20.</span>), (<span class="hljs-number">1.5</span>, <span class="hljs-number">20.</span>), (<span class="hljs-number">0.</span>, <span class="hljs-number">140.</span>)]
    },
    <span class="hljs-string">&quot;rebound_spike&quot;</span>: {
        <span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0.005</span>,
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">0</span>, <span class="hljs-number">50.</span>), (<span class="hljs-number">-3.5</span>, <span class="hljs-number">750.</span>), (<span class="hljs-number">0.</span>, <span class="hljs-number">200.</span>)]
    },
    <span class="hljs-string">&quot;class_2&quot;</span>: {
        <span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0.005</span>,
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">2</span> * (<span class="hljs-number">1.</span> + <span class="hljs-number">1e-6</span>), <span class="hljs-number">200.</span>)],
        <span class="hljs-string">&quot;V_th&quot;</span>: <span class="hljs-number">-30.</span>
    },
    <span class="hljs-string">&quot;integrator&quot;</span>: {
        <span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0.005</span>,
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">1.5</span>, <span class="hljs-number">20.</span>), (<span class="hljs-number">0.</span>, <span class="hljs-number">10.</span>), (<span class="hljs-number">1.5</span>, <span class="hljs-number">20.</span>), (<span class="hljs-number">0.</span>, <span class="hljs-number">250.</span>),
                  (<span class="hljs-number">1.5</span>, <span class="hljs-number">20.</span>), (<span class="hljs-number">0.</span>, <span class="hljs-number">30.</span>), (<span class="hljs-number">1.5</span>, <span class="hljs-number">20.</span>), (<span class="hljs-number">0.</span>, <span class="hljs-number">30.</span>)]
    },
    <span class="hljs-string">&quot;input_bistability&quot;</span>: {
        <span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0.005</span>,
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">1.5</span>, <span class="hljs-number">100.</span>), (<span class="hljs-number">1.7</span>, <span class="hljs-number">400.</span>),
                  (<span class="hljs-number">1.5</span>, <span class="hljs-number">100.</span>), (<span class="hljs-number">1.7</span>, <span class="hljs-number">400.</span>)]
    },
    <span class="hljs-string">&quot;hyperpolarization_induced_spiking&quot;</span>: {
        <span class="hljs-string">&quot;V_th_reset&quot;</span>: <span class="hljs-number">-60.</span>,
        <span class="hljs-string">&quot;V_th_inf&quot;</span>: <span class="hljs-number">-120.</span>,
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">-1.</span>, <span class="hljs-number">400.</span>)],
        <span class="hljs-string">&quot;V_th&quot;</span>: <span class="hljs-number">-50.</span>
    },
    <span class="hljs-string">&quot;hyperpolarization_induced_bursting&quot;</span>: {
        <span class="hljs-string">&quot;V_th_reset&quot;</span>: <span class="hljs-number">-60.</span>,
        <span class="hljs-string">&quot;V_th_inf&quot;</span>: <span class="hljs-number">-120.</span>,
        <span class="hljs-string">&quot;A1&quot;</span>: <span class="hljs-number">10.</span>,
        <span class="hljs-string">&quot;A2&quot;</span>: <span class="hljs-number">-0.6</span>,
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">-1.</span>, <span class="hljs-number">400.</span>)],
        <span class="hljs-string">&quot;V_th&quot;</span>: <span class="hljs-number">-50.</span>
    },
    <span class="hljs-string">&quot;tonic_bursting&quot;</span>: {
        <span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0.005</span>,
        <span class="hljs-string">&quot;A1&quot;</span>: <span class="hljs-number">10.</span>,
        <span class="hljs-string">&quot;A2&quot;</span>: <span class="hljs-number">-0.6</span>,
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">2.</span>, <span class="hljs-number">500.</span>)]
    },
    <span class="hljs-string">&quot;phasic_bursting&quot;</span>: {
        <span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0.005</span>,
        <span class="hljs-string">&quot;A1&quot;</span>: <span class="hljs-number">10.</span>,
        <span class="hljs-string">&quot;A2&quot;</span>: <span class="hljs-number">-0.6</span>,
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">1.5</span>, <span class="hljs-number">500.</span>)]
    },
    <span class="hljs-string">&quot;rebound_burst&quot;</span>: {
        <span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0.005</span>,
        <span class="hljs-string">&quot;A1&quot;</span>: <span class="hljs-number">10.</span>,
        <span class="hljs-string">&quot;A2&quot;</span>: <span class="hljs-number">-0.6</span>,
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">0</span>, <span class="hljs-number">100.</span>), (<span class="hljs-number">-3.5</span>, <span class="hljs-number">500.</span>), (<span class="hljs-number">0.</span>, <span class="hljs-number">400.</span>)]
    },
    <span class="hljs-string">&quot;mixed_mode&quot;</span>: {
        <span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0.005</span>,
        <span class="hljs-string">&quot;A1&quot;</span>: <span class="hljs-number">5.</span>,
        <span class="hljs-string">&quot;A2&quot;</span>: <span class="hljs-number">-0.3</span>,
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">2.</span>, <span class="hljs-number">500.</span>)]
    },
    <span class="hljs-string">&quot;afterpotentials&quot;</span>: {
        <span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0.005</span>,
        <span class="hljs-string">&quot;A1&quot;</span>: <span class="hljs-number">5.</span>,
        <span class="hljs-string">&quot;A2&quot;</span>: <span class="hljs-number">-0.3</span>,
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">2.</span>, <span class="hljs-number">15.</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">185.</span>)]
    },
    <span class="hljs-string">&quot;basal_bistability&quot;</span>: {
        <span class="hljs-string">&quot;A1&quot;</span>: <span class="hljs-number">8.</span>,
        <span class="hljs-string">&quot;A2&quot;</span>: <span class="hljs-number">-0.1</span>,
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">5.</span>, <span class="hljs-number">10.</span>), (<span class="hljs-number">0.</span>, <span class="hljs-number">90.</span>), (<span class="hljs-number">5.</span>, <span class="hljs-number">10.</span>), (<span class="hljs-number">0.</span>, <span class="hljs-number">90.</span>)]
    },
    <span class="hljs-string">&quot;preferred_frequency&quot;</span>: {
        <span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">0.005</span>,
        <span class="hljs-string">&quot;A1&quot;</span>: <span class="hljs-number">-3.</span>,
        <span class="hljs-string">&quot;A2&quot;</span>: <span class="hljs-number">0.5</span>,
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">5.</span>, <span class="hljs-number">10.</span>), (<span class="hljs-number">0.</span>, <span class="hljs-number">10.</span>), (<span class="hljs-number">4.</span>, <span class="hljs-number">10.</span>), (<span class="hljs-number">0.</span>, <span class="hljs-number">370.</span>),
                  (<span class="hljs-number">5.</span>, <span class="hljs-number">10.</span>), (<span class="hljs-number">0.</span>, <span class="hljs-number">90.</span>), (<span class="hljs-number">4.</span>, <span class="hljs-number">10.</span>), (<span class="hljs-number">0.</span>, <span class="hljs-number">290.</span>)]
    },
    <span class="hljs-string">&quot;spike_latency&quot;</span>: {
        <span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">-0.08</span>,
        <span class="hljs-string">&quot;input&quot;</span>: [(<span class="hljs-number">8.</span>, <span class="hljs-number">2.</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">48.</span>)]
    }
}


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_GIF_with_mode</span><span class="hljs-params">(mode=<span class="hljs-string">&apos;tonic_spiking&apos;</span>, size=<span class="hljs-number">10.</span>,
                      row_p=<span class="hljs-number">0</span>, col_p=<span class="hljs-number">0</span>, fig=None, gs=None)</span>:</span>
    print(f<span class="hljs-string">&quot;Running GIF neuron neu with mode &apos;{mode}&apos;&quot;</span>)
    neu = brainmodels.neurons.GeneralizedIF(size, monitors=[<span class="hljs-string">&apos;V&apos;</span>, <span class="hljs-string">&apos;V_th&apos;</span>, <span class="hljs-string">&apos;I1&apos;</span>, <span class="hljs-string">&apos;I2&apos;</span>, <span class="hljs-string">&apos;input&apos;</span>])
    param = mode2param[mode].items()
    member_type = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> (k, v) <span class="hljs-keyword">in</span> param:
        <span class="hljs-keyword">if</span> k == <span class="hljs-string">&apos;input&apos;</span>:
            I_ext, dur = bp.inputs.constant_current(v)
            member_type += <span class="hljs-number">1</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">if</span> member_type == <span class="hljs-number">0</span>:
                exec(<span class="hljs-string">&quot;neu.%s = %f&quot;</span> % (k, v))
            <span class="hljs-keyword">else</span>:
                exec(<span class="hljs-string">&quot;neu.%s = bp.ops.ones(size) * %f&quot;</span> % (k, v))
    neu.run(dur, inputs=(<span class="hljs-string">&apos;input&apos;</span>, I_ext), report=<span class="hljs-keyword">False</span>)

    ts = neu.mon.ts
    ax1 = fig.add_subplot(gs[row_p, col_p])
    ax1.title.set_text(f<span class="hljs-string">&apos;{mode}&apos;</span>)

    ax1.plot(ts, neu.mon.V[:, <span class="hljs-number">0</span>], label=<span class="hljs-string">&apos;V&apos;</span>)
    ax1.plot(ts, neu.mon.V_th[:, <span class="hljs-number">0</span>], label=<span class="hljs-string">&apos;V_th&apos;</span>)
    ax1.set_xlabel(<span class="hljs-string">&apos;Time (ms)&apos;</span>)
    ax1.set_ylabel(<span class="hljs-string">&apos;Membrane potential&apos;</span>)
    ax1.set_xlim(<span class="hljs-number">-0.1</span>, ts[<span class="hljs-number">-1</span>] + <span class="hljs-number">0.1</span>)
    plt.legend()

    ax2 = ax1.twinx()
    ax2.plot(ts, I_ext, color=<span class="hljs-string">&apos;turquoise&apos;</span>, label=<span class="hljs-string">&apos;input&apos;</span>)
    ax2.set_xlabel(<span class="hljs-string">&apos;Time (ms)&apos;</span>)
    ax2.set_ylabel(<span class="hljs-string">&apos;External input&apos;</span>)
    ax2.set_xlim(<span class="hljs-number">-0.1</span>, ts[<span class="hljs-number">-1</span>] + <span class="hljs-number">0.1</span>)
    ax2.set_ylim(<span class="hljs-number">-5.</span>, <span class="hljs-number">20.</span>)
    plt.legend(loc=<span class="hljs-string">&apos;lower left&apos;</span>)


size = <span class="hljs-number">10</span>
pattern_num = <span class="hljs-number">20</span>
row_b = <span class="hljs-number">2</span>
col_b = <span class="hljs-number">2</span>
size_b = row_b * col_b
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(pattern_num):
    <span class="hljs-keyword">if</span> i % size_b == <span class="hljs-number">0</span>:
        fig, gs = bp.visualize.get_figure(row_b, col_b, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>)
    mode = num2mode[i]
    run_GIF_with_mode(mode=mode, size=size,
                      row_p=i % size_b // col_b,
                      col_p=i % size_b % col_b,
                      fig=fig, gs=gs)
    <span class="hljs-keyword">if</span> (i + <span class="hljs-number">1</span>) % size_b == <span class="hljs-number">0</span>:
        plt.show()
</code></pre>
<hr>
<h2 id="firing-rate-models">Firing rate models</h2>
<h3 id="firing-rate-unit-model">Firing Rate Unit model</h3>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> brainpy <span class="hljs-keyword">as</span> bp
<span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> prange

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FiringRateUnit</span><span class="hljs-params">(bp.NeuGroup)</span>:</span>
    target_backend = <span class="hljs-string">&apos;general&apos;</span>

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">derivative</span><span class="hljs-params">(a_e, a_i, t,
                   k_e, r_e, c1, c2, I_ext_e, slope_e, theta_e, tau_e,
                   k_i, r_i, c3, c4, I_ext_i, slope_i, theta_i, tau_i)</span>:</span>
        x_ae = c1 * a_e - c2 * a_i + I_ext_e
        sigmoid_ae_l = <span class="hljs-number">1</span> / (<span class="hljs-number">1</span> + bp.ops.exp(- slope_e * (x_ae - theta_e)))
        sigmoid_ae_r = <span class="hljs-number">1</span> / (<span class="hljs-number">1</span> + bp.ops.exp(slope_e * theta_e))
        sigmoid_ae = sigmoid_ae_l - sigmoid_ae_r
        daedt = (- a_e + (k_e - r_e * a_e) * sigmoid_ae) / tau_e

        x_ai = c3 * a_e - c4 * a_i + I_ext_i
        sigmoid_ai_l = <span class="hljs-number">1</span> / (<span class="hljs-number">1</span> + bp.ops.exp(- slope_i * (x_ai - theta_i)))
        sigmoid_ai_r = <span class="hljs-number">1</span> / (<span class="hljs-number">1</span> + bp.ops.exp(slope_i * theta_i))
        sigmoid_ai = sigmoid_ai_l - sigmoid_ai_r
        daidt = (- a_i + (k_i - r_i * a_i) * sigmoid_ai) / tau_i
        <span class="hljs-keyword">return</span> daedt, daidt

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, size, c1=<span class="hljs-number">12.</span>, c2=<span class="hljs-number">4.</span>, c3=<span class="hljs-number">13.</span>, c4=<span class="hljs-number">11.</span>,
                 k_e=<span class="hljs-number">1.</span>, k_i=<span class="hljs-number">1.</span>, tau_e=<span class="hljs-number">1.</span>, tau_i=<span class="hljs-number">1.</span>, r_e=<span class="hljs-number">1.</span>, r_i=<span class="hljs-number">1.</span>,
                 slope_e=<span class="hljs-number">1.2</span>, slope_i=<span class="hljs-number">1.</span>, theta_e=<span class="hljs-number">2.8</span>, theta_i=<span class="hljs-number">4.</span>,
                 **kwargs)</span>:</span>
        <span class="hljs-comment"># params</span>
        self.c1 = c1
        self.c2 = c2
        self.c3 = c3
        self.c4 = c4
        self.k_e = k_e
        self.k_i = k_i
        self.tau_e = tau_e
        self.tau_i = tau_i
        self.r_e = r_e
        self.r_i = r_i
        self.slope_e = slope_e
        self.slope_i = slope_i
        self.theta_e = theta_e
        self.theta_i = theta_i

        <span class="hljs-comment"># vars</span>
        self.input_e = bp.backend.zeros(size)
        self.input_i = bp.backend.zeros(size)
        self.a_e = bp.backend.ones(size) * <span class="hljs-number">0.1</span>
        self.a_i = bp.backend.ones(size) * <span class="hljs-number">0.05</span>

        self.integral = bp.odeint(self.derivative)
        super(FiringRateUnit, self).__init__(size=size, **kwargs)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(self, _t)</span>:</span>
        self.a_e, self.a_i = self.integral(
            self.a_e, self.a_i, _t,
            self.k_e, self.r_e, self.c1, self.c2,
            self.input_e, self.slope_e,
            self.theta_e, self.tau_e,
            self.k_i, self.r_i, self.c3, self.c4,
            self.input_i, self.slope_i,
            self.theta_i, self.tau_i)
        self.input_e[:] = <span class="hljs-number">0.</span>
        self.input_i[:] = <span class="hljs-number">0.</span>
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../appendix.html" class="navigation navigation-prev " aria-label="Previous page: Appendix: model code">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="synapses.html" class="navigation navigation-next " aria-label="Next page: Synapse models">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Neuron models","level":"1.5.1","depth":2,"next":{"title":"Synapse models","level":"1.5.2","depth":2,"path":"appendix/synapses.md","ref":"appendix/synapses.md","articles":[]},"previous":{"title":"Appendix: model code","level":"1.5","depth":1,"path":"appendix.md","ref":"appendix.md","articles":[{"title":"Neuron models","level":"1.5.1","depth":2,"path":"appendix/neurons.md","ref":"appendix/neurons.md","articles":[]},{"title":"Synapse models","level":"1.5.2","depth":2,"path":"appendix/synapses.md","ref":"appendix/synapses.md","articles":[]},{"title":"Network models","level":"1.5.3","depth":2,"path":"appendix/networks.md","ref":"appendix/networks.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["katex","code","splitter","-lunr","-search","search-pro"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"katex":{},"code":{"copyButtons":true},"splitter":{},"search-pro":{},"highlight":{},"sharing":{"all":["facebook","google","twitter","weibo","instapaper"],"facebook":true,"google":false,"instapaper":false,"twitter":true,"vk":false,"weibo":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageBreaksBefore":"/","headerTemplate":"_TITLE_","paperSize":"a4","margin":{"right":62,"left":62,"top":56,"bottom":56},"fontSize":12,"fontFamily":"Arial","footerTemplate":null,"chapterMark":"pagebreak","pageNumbers":true},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"BrainPy Handbook","language":"en","gitbook":"*","description":"A Handbook introducing how to implement brain models by BrainPy for computational neuroscience."},"file":{"path":"appendix/neurons.md","mtime":"2021-05-18T08:21:08.257Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-05-18T09:15:55.653Z"},"basePath":"..","book":{"language":"en"}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

